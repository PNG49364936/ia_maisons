<div style="background: #fff8b3; padding: 10px; margin-bottom: 10px;">
  <p><b>DEBUG</b> - @resultat présent ? <%= @resultat.present? %></p>
  <p>@resultat : <%= @resultat.inspect %></p>
  <p>params : <%= params.inspect %></p>
</div>

<h1>💡 Estimation du prix d'une maison</h1>

<%= form_with url: predict_path, method: :post, data: { turbo: false } do |form| %>
  <div>
    <%= form.label :taille, "Taille de la maison (m²) :" %>
    <%= form.number_field :taille, step: 1, required: true %>
  </div>
  <div style="margin-top: 10px;">
    <%= form.submit "Prédire le prix" %>
  </div>
<% end %>

<% if @resultat.present? %>
  <% if @resultat.include?("⚠️") %>
    <div style="color: red; margin-top: 10px;"><%= @resultat %></div>
  <% else %>
    <h2 style="color: green; margin-top: 20px;"><%= @resultat %></h2>
  <% end %>
<% end %>

<hr>

<h3>📈 Ajouter une donnée réelle</h3>
<%= form_with model: TrainingDatum.new, url: training_data_path, method: :post do |f| %>
  <div>
    <%= f.label :taille, "Taille (m²)" %>
    <%= f.number_field :taille, step: 1, required: true %>
  </div>
  <div>
    <%= f.label :prix, "Prix réel (€)" %>
    <%= f.number_field :prix, step: 1000, required: true %>
  </div>
  <div style="margin-top: 10px;">
    <%= f.submit "Ajouter cette donnée" %>
  </div>
<% end %>

<hr>

<h3>📊 Données d'entraînement actuelles</h3>
<% if @training_data.any? %>
  <table border="1" cellspacing="0" cellpadding="6" style="margin-top:10px; border-collapse: collapse;">
    <thead style="background-color: #f0f0f0;">
      <tr>
        <th>Taille (m²)</th>
        <th>Prix (€)</th>
      </tr>
    </thead>
    <tbody>
      <% @training_data.each do |d| %>
        <tr>
          <td><%= d.taille %></td>
          <td><%= number_with_delimiter(d.prix.to_i, delimiter: " ") %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p style="color: #666;">Aucune donnée enregistrée pour le moment.</p>
<% end %>

<hr>
<pre><%= @graph_data.inspect %></pre>

<hr>

<h3>📉 Graphique : Données d’entraînement + Prédiction</h3>

<pre>
DEBUG - @taille: <%= @taille.inspect %>
DEBUG - @prix_prevu: <%= @prix_prevu.inspect %>
</pre>

<% if @graph_data.present? %>
  <%= line_chart [
        { name: "Données réelles", data: @graph_data, color: "#4CAF50" },
        # 🔴 Afficher le point de prédiction s’il existe
        (@taille && @prix_prevu) ? { 
          name: "Prédiction", 
          data: { @taille => @prix_prevu },
          color: "#FF0000",
          points: true
        } : nil
      ].compact,
      xtitle: "Taille (m²)",
      ytitle: "Prix (€)"
  %>
<% end %>

<% if @prix_prevu %>
  <p style="margin-top: 15px; font-size: 18px;">
    💰 <b>Prix prédit :</b>
    <%= number_with_delimiter(@prix_prevu.round(0).to_i, delimiter: " ") %> €
    pour une maison de <%= @taille.to_i %> m²
  </p>
<% else %>
  <p style="color: #888;">(Aucune prédiction encore calculée)</p>
<% end %>












